<view class="page">
  <view class="container">
    <!-- é¦–æ¬¡åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading && (!messagesList || messagesList.length === 0)}}" class="loading-container">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error && (!messagesList || messagesList.length === 0)}}" class="error-container">
      <text class="error-text">{{errorMessage || 'è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'}}</text>
      <button class="retry-btn" bindtap="retryLoad" size="mini" plain>é‡è¯•</button>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{!messagesList || messagesList.length === 0}}" class="empty-container">
      <text class="empty-text">æš‚æ— æ¶ˆæ¯</text>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <view wx:else class="messages-list">
      <view 
        wx:for="{{messagesList}}" 
        wx:key="uniqueKey"
        class="message-card"
        bindtap="viewArticleDetail"
        data-item="{{item.post || item}}"
      >
        <view class="message-content-wrapper">
          <view class="message-header">
            <view class="message-type-badge {{item.type === 'comment' ? 'type-comment' : (item.type === 'like' ? 'type-like' : 'type-favorite')}}">
              <text class="message-type-icon">{{item.type === 'comment' ? 'ğŸ’¬' : (item.type === 'like' ? 'â¤ï¸' : 'â­')}}</text>
              <text class="message-type-text">{{item.type === 'comment' ? 'è¯„è®º' : (item.type === 'like' ? 'ç‚¹èµ' : 'æ”¶è—')}}</text>
            </view>
          </view>
          <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨é¡¶éƒ¨ -->
          <view wx:if="{{item.user && (item.user.name || item.user.phone)}}" class="message-user">
            <text class="message-user-name">{{item.user.name || item.user.phone || 'ç”¨æˆ·'}}</text>
            <text wx:if="{{item.type === 'comment'}}" class="message-user-action">è¯„è®ºäº†æ‚¨çš„æ–‡ç« </text>
            <text wx:elif="{{item.type === 'like'}}" class="message-user-action">ç‚¹èµäº†æ‚¨çš„æ–‡ç« </text>
            <text wx:else class="message-user-action">æ”¶è—äº†æ‚¨çš„æ–‡ç« </text>
          </view>
          <view class="message-post-title">{{item.post ? (item.post.title || item.post.name) : 'æ–‡ç« å·²åˆ é™¤'}}</view>
          <view class="message-meta-row">
            <text class="message-time">{{item.displayTime || item.createdAt || item.created_at || item.likedAt || item.favoritedAt || ''}}</text>
          </view>
          <view wx:if="{{item.type === 'comment' && item.content}}" class="message-comment-content">{{item.content}}</view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤šæŒ‰é’®å’ŒåŠ è½½çŠ¶æ€ -->
      <view class="load-more-container">
        <view wx:if="{{loading && messagesList.length > 0}}" class="loading-more">
          <text class="loading-more-text">åŠ è½½ä¸­...</text>
        </view>
        <button 
          wx:elif="{{hasMore && !loading}}" 
          class="load-more-btn" 
          bindtap="loadMore" 
          size="mini" 
          plain
        >
          åŠ è½½æ›´å¤š
        </button>
        <view wx:elif="{{!hasMore && messagesList.length > 0}}" class="no-more">
          <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
      </view>
    </view>
  </view>
</view>

