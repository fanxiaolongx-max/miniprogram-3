<view class="page" data-weui-theme="{{theme}}">
  <view class="container">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error}}" class="error-container">
      <text class="error-text">è·å–å†…å®¹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</text>
      <button class="retry-btn" bindtap="retry">é‡è¯•</button>
    </view>

    <!-- å†…å®¹å±•ç¤º -->
    <view wx:else class="article-container">
      <view wx:if="{{title}}" class="article-title">{{title}}</view>
      
      <!-- æ–‡ç« å…ƒä¿¡æ¯åŒºåŸŸ -->
      <view wx:if="{{meta || views > 0 || authorInfo}}" class="article-meta">
        <!-- ç¬¬ä¸€è¡Œï¼šæ—¶é—´å’Œæµè§ˆé‡ -->
        <view wx:if="{{meta || views > 0}}" class="meta-row-1">
          <text wx:if="{{meta}}" class="meta-time">{{meta}}</text>
          <text wx:if="{{meta && views > 0}}" class="meta-separator"> Â· </text>
          <text wx:if="{{views > 0}}" class="meta-views">{{formattedViews}} æµè§ˆ</text>
        </view>
        
        <!-- ç¬¬äºŒè¡Œï¼šå‘å¸ƒè€…ä¿¡æ¯å’Œè®¾å¤‡ä¿¡æ¯ -->
        <view wx:if="{{authorInfo && (authorInfo.nickname || authorInfo.phone || authorInfo.deviceModel)}}" class="meta-row-2">
          <text wx:if="{{authorInfo.nickname}}" class="author-nickname">ğŸ§”ğŸ» {{authorInfo.nickname}}</text>
          <text wx:if="{{authorInfo.nickname && authorInfo.phone}}" class="author-separator"> </text>
          <text wx:if="{{authorInfo.phone}}" class="author-phone" bindtap="makePhoneCall" data-phone="{{authorInfo.phone}}">â˜ï¸ ({{authorInfo.phone}})</text>
          <text wx:if="{{authorInfo.deviceModel}}" class="device-tag">ğŸ“± {{authorInfo.deviceModel}}</text>
        </view>
      </view>
      
      <!-- ä½¿ç”¨è§£æåçš„èŠ‚ç‚¹æ•°ç»„è¿›è¡Œå†…è”æ¸²æŸ“ -->
      <view wx:if="{{parsedContent && parsedContent.length > 0}}" class="article-content-parsed">
        <block wx:if="{{parsedContent}}" wx:for="{{parsedContent}}" wx:key="index" wx:for-index="nodeIndex" wx:for-item="node">
          <!-- æ–‡æœ¬èŠ‚ç‚¹ -->
          <rich-text wx:if="{{node.type === 'text'}}" class="article-text-node" nodes="{{node.content}}" selectable="{{true}}"></rich-text>
          
          <!-- å›¾ç‰‡èŠ‚ç‚¹ -->
          <view wx:elif="{{node.type === 'image'}}" class="article-image-node">
            <image 
              class="article-inline-image"
              src="{{node.url}}"
              mode="widthFix"
              bindtap="previewImageFromNode"
              data-url="{{node.url}}"
              data-index="{{nodeIndex}}"
              show-menu-by-longpress="{{true}}"
            ></image>
          </view>
          
          <!-- è§†é¢‘èŠ‚ç‚¹ -->
          <view wx:elif="{{node.type === 'video'}}" class="article-video-node">
            <block wx:if="{{node.poster}}">
              <video 
                class="article-inline-video"
                src="{{node.src}}"
                poster="{{node.poster}}"
                controls="{{true}}"
                show-center-play-btn="{{true}}"
                enable-play-gesture="{{true}}"
                object-fit="contain"
                lazy-load="{{true}}"
                initial-time="{{0}}"
                binderror="onVideoError"
                data-index="{{nodeIndex}}"
              ></video>
            </block>
            <block wx:else>
              <video 
                class="article-inline-video"
                src="{{node.src}}"
                controls="{{true}}"
                show-center-play-btn="{{true}}"
                enable-play-gesture="{{true}}"
                object-fit="contain"
                lazy-load="{{true}}"
                initial-time="{{0}}"
                binderror="onVideoError"
                data-index="{{nodeIndex}}"
              ></video>
            </block>
          </view>
          
          <!-- é“¾æ¥èŠ‚ç‚¹ -->
          <view wx:elif="{{node.type === 'link'}}" class="article-link-node">
            <view class="inline-link-item" bindtap="copyLink" data-url="{{node.url}}">
              <text class="inline-link-icon">ğŸ”—</text>
              <text class="inline-link-text">{{node.text}}</text>
              <text class="inline-link-hint">ç‚¹å‡»å¤åˆ¶</text>
            </view>
          </view>
        </block>
      </view>
      
      <!-- å‘åå…¼å®¹ï¼šå¦‚æœæ²¡æœ‰è§£æåçš„å†…å®¹ï¼Œä½¿ç”¨åŸæ¥çš„ rich-text -->
      <rich-text wx:else class="article-content" nodes="{{content}}" selectable="{{true}}"></rich-text>
      
      <!-- æ–‡ç« åœ°å€åœ°å›¾åŒºåŸŸ -->
      <view wx:if="{{location}}" class="location-section">
        <view class="location-title">ä½ç½®ä¿¡æ¯</view>
        <view class="location-info">
          <view wx:if="{{location.name}}" class="location-name">{{location.name}}</view>
          <view wx:if="{{location.address}}" class="location-address">{{location.address}}</view>
        </view>
        <map
          class="location-map"
          longitude="{{location.longitude}}"
          latitude="{{location.latitude}}"
          scale="16"
          markers="{{mapMarkers}}"
          bindtap="openLocation"
          show-location="{{true}}"
        ></map>
        <view class="location-tip">ç‚¹å‡»åœ°å›¾æ‰“å¼€å¯¼èˆª</view>
      </view>
      
      <!-- æ–‡ç« å›¾ç‰‡åŒºåŸŸï¼ˆç¼©ç•¥å›¾ç½‘æ ¼ï¼Œæ”¯æŒç‚¹å‡»æŸ¥çœ‹å¤§å›¾å’Œé•¿æŒ‰ä¿å­˜ï¼‰- ä»…åœ¨æœªä½¿ç”¨å†…è”æ¸²æŸ“æ—¶æ˜¾ç¤º -->
      <view wx:if="{{images && images.length > 0 && (!parsedContent || parsedContent.length === 0)}}" class="images-section">
        <view class="images-title">æ–‡ç« å›¾ç‰‡</view>
        <view class="images-container">
          <block wx:if="{{images}}">
            <image 
              wx:for="{{images}}" 
              wx:key="*this"
              wx:for-index="index"
            class="article-image-thumbnail"
            src="{{item}}"
            mode="aspectFill"
            bindtap="previewImage"
            data-url="{{item}}"
            data-index="{{index}}"
            show-menu-by-longpress="{{true}}"
          ></image>
          </block>
        </view>
      </view>
      
      <!-- æ–‡ç« è§†é¢‘åŒºåŸŸ - ä»…åœ¨æœªä½¿ç”¨å†…è”æ¸²æŸ“æ—¶æ˜¾ç¤º -->
      <view wx:if="{{videos && videos.length > 0 && (!parsedContent || parsedContent.length === 0)}}" class="videos-section">
        <view class="videos-title">æ–‡ç« è§†é¢‘</view>
        <view class="videos-container">
          <block wx:if="{{videos}}" wx:for="{{videos}}" wx:key="src" wx:for-index="index">
            <!-- æœ‰ poster çš„è§†é¢‘ -->
            <video 
              wx:if="{{item.poster}}"
              class="article-video"
              src="{{item.src}}"
              poster="{{item.poster}}"
              controls="{{true}}"
              show-center-play-btn="{{true}}"
              enable-play-gesture="{{true}}"
              object-fit="contain"
              lazy-load="{{true}}"
              initial-time="{{0}}"
              binderror="onVideoError"
              data-index="{{index}}"
            ></video>
            <!-- æ²¡æœ‰ poster çš„è§†é¢‘ -->
            <video 
              wx:else
              class="article-video"
              src="{{item.src}}"
              controls="{{true}}"
              show-center-play-btn="{{true}}"
              enable-play-gesture="{{true}}"
              object-fit="contain"
              lazy-load="{{true}}"
              initial-time="{{0}}"
              binderror="onVideoError"
              data-index="{{index}}"
            ></video>
          </block>
        </view>
      </view>
      
      <!-- æ–‡ç« é“¾æ¥åŒºåŸŸ - ä»…åœ¨æœªä½¿ç”¨å†…è”æ¸²æŸ“æ—¶æ˜¾ç¤º -->
      <view wx:if="{{links && links.length > 0 && (!parsedContent || parsedContent.length === 0)}}" class="links-section">
        <view class="links-title">æ–‡ç« é“¾æ¥</view>
        <view class="links-container">
          <block wx:if="{{links}}">
            <view 
              wx:for="{{links}}" 
              wx:key="url" 
              class="link-item"
            bindtap="copyLink"
            data-url="{{item.url}}"
          >
            <view class="link-icon">ğŸ”—</view>
            <view class="link-content">
              <view class="link-text">{{item.text}}</view>
              <view class="link-url">{{item.url}}</view>
            </view>
            <view class="link-action">å¤åˆ¶</view>
          </view>
          </block>
        </view>
      </view>
    </view>
  </view>
</view>
