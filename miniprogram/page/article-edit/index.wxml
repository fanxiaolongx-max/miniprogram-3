<view class="page {{theme === 'dark' ? 'dark-theme' : ''}}" data-weui-theme="{{theme}}">
  <view class="container">
    <!-- é¡¶éƒ¨æ“ä½œæ  -->
    <view class="header-section">
      <view class="cancel-btn" bindtap="cancel">å–æ¶ˆ</view>
      <view class="header-title">{{mode === 'create' ? 'å‘å¸ƒæ–‡ç« ' : 'ç¼–è¾‘æ–‡ç« '}}</view>
      <view class="save-btn" bindtap="saveArticle">
        <text wx:if="{{saving}}">å‘å¸ƒä¸­</text>
        <text wx:else>å‘å¸ƒ</text>
      </view>
    </view>

    <!-- ä¸»ç¼–è¾‘åŒº -->
    <scroll-view class="editor-container" scroll-y scroll-into-view="{{scrollIntoView}}">
      <!-- æ ‡é¢˜è¾“å…¥åŒº -->
      <view class="title-section">
        <input 
          class="title-input {{errors.name ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥æ ‡é¢˜"
          placeholder-style="color: #999;"
          value="{{name}}"
          data-field="name"
          bindinput="onInput"
          bindfocus="onTitleFocus"
          bindblur="onTitleBlur"
          style="color: #333;"
          maxlength="100"
        />
        <view wx:if="{{errors.name}}" class="error-text">{{errors.name}}</view>
      </view>

      <!-- åˆ†ç±»é€‰æ‹©ï¼ˆç®€åŒ–æ˜¾ç¤ºï¼‰ -->
      <view class="category-section" bindtap="showCategoryPicker">
        <text class="category-label">åˆ†ç±»</text>
        <text wx:if="{{apiName}}" class="category-value">{{apiName}}</text>
        <text wx:else class="category-placeholder">è¯·é€‰æ‹©åˆ†ç±»</text>
        <text class="category-arrow">â€º</text>
      </view>
      <view wx:if="{{errors.apiName}}" class="error-text">{{errors.apiName}}</view>

      <!-- è”ç³»æ–¹å¼åŒºåŸŸï¼ˆæ‰€æœ‰åˆ†ç±»éƒ½æ”¯æŒï¼ŒäºŒæ‰‹å¸‚åœºåˆ†ç±»å¿…å¡«ï¼Œç‰¹å®šåˆ†ç±»éšè—ï¼‰ -->
      <view wx:if="{{!hideContactFields}}" id="contact-section" class="contact-section">
        <!-- æ‰‹æœºå·è¾“å…¥ -->
        <view class="contact-item {{errors.phone ? 'error' : ''}}">
          <text class="contact-label">
            <text>æ‰‹æœºå·</text>
            <text wx:if="{{isSecondHand}}" class="required-mark">*</text>
          </text>
          <view class="contact-input-wrapper">
            <input 
              class="contact-input"
              placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
              placeholder-style="color: #999;"
              value="{{phone}}"
              type="number"
              bindinput="onPhoneInput"
              maxlength="20"
            />
          </view>
        </view>
        <view wx:if="{{errors.phone}}" class="error-text">{{errors.phone}}</view>

        <!-- åˆ†å‰²çº¿ -->
        <view class="contact-divider"></view>

        <!-- åœ°å›¾å®šä½é€‰æ‹© -->
        <view class="contact-item {{errors.address ? 'error' : ''}}" bindtap="chooseLocation">
          <text class="contact-label">
            <text>åœ°å›¾å®šä½</text>
            <text wx:if="{{isSecondHand}}" class="required-mark">*</text>
          </text>
          <view class="contact-value-wrapper">
            <text wx:if="{{address}}" class="contact-value">{{address}}</text>
            <text wx:else class="contact-placeholder">è¯·é€‰æ‹©åœ°å›¾å®šä½</text>
            <text class="contact-arrow">â€º</text>
          </view>
        </view>
        <view wx:if="{{errors.address}}" class="error-text">{{errors.address}}</view>
      </view>

      <!-- ä»·æ ¼è¾“å…¥åŒºåŸŸï¼ˆäºŒæ‰‹å¸‚åœºåˆ†ç±»ï¼‰ -->
      <view wx:if="{{isSecondHand}}" class="contact-section">
        <view class="contact-item">
          <text class="contact-label">ä»·æ ¼ï¼ˆEGPï¼‰</text>
          <view class="contact-input-wrapper">
            <input 
              class="contact-input"
              placeholder="è¯·è¾“å…¥ä»·æ ¼"
              placeholder-style="color: #999;"
              value="{{price}}"
              type="digit"
              bindinput="onPriceInput"
              maxlength="20"
            />
          </view>
        </view>
      </view>

      <!-- ä»·æ ¼ã€æˆ¿é—´æ•°ã€é¢ç§¯è¾“å…¥åŒºåŸŸï¼ˆç§Ÿæˆ¿é…’åº—åˆ†ç±»ï¼‰ -->
      <view wx:if="{{isRental}}" class="contact-section">
        <!-- ä»·æ ¼ -->
        <view class="contact-item">
          <text class="contact-label">ä»·æ ¼ï¼ˆEGPï¼‰</text>
          <view class="contact-input-wrapper">
            <input 
              class="contact-input"
              placeholder="è¯·è¾“å…¥ä»·æ ¼"
              placeholder-style="color: #999;"
              value="{{price}}"
              type="digit"
              bindinput="onPriceInput"
              maxlength="20"
            />
          </view>
        </view>
        
        <!-- åˆ†å‰²çº¿ -->
        <view class="contact-divider"></view>
        
        <!-- æˆ¿é—´æ•° -->
        <view class="contact-item">
          <text class="contact-label">æˆ¿é—´æ•°</text>
          <view class="contact-input-wrapper">
            <input 
              class="contact-input"
              placeholder="è¯·è¾“å…¥æˆ¿é—´æ•°"
              placeholder-style="color: #999;"
              value="{{rooms}}"
              type="number"
              bindinput="onRoomsInput"
              maxlength="10"
            />
          </view>
        </view>
        
        <!-- åˆ†å‰²çº¿ -->
        <view class="contact-divider"></view>
        
        <!-- é¢ç§¯ -->
        <view class="contact-item">
          <text class="contact-label">é¢ç§¯</text>
          <view class="contact-input-wrapper">
            <input 
              class="contact-input"
              placeholder="è¯·è¾“å…¥é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰"
              placeholder-style="color: #999;"
              value="{{area}}"
              type="digit"
              bindinput="onAreaInput"
              maxlength="20"
            />
          </view>
        </view>
      </view>

      <!-- å†…å®¹è¾“å…¥åŒº -->
      <view class="content-section">
        <editor
          id="content-editor"
          class="content-editor"
          placeholder="æƒ³è¯´ç‚¹ä»€ä¹ˆ..."
          bindready="onEditorReady"
          bindinput="onEditorInput"
          bindstatuschange="onEditorStatusChange"
          show-img-size="{{false}}"
          show-img-toolbar="{{false}}"
          show-img-resize="{{false}}"
        />
      </view>

      <!-- åº•éƒ¨é—´è·ï¼Œé¿å…è¢«å·¥å…·æ é®æŒ¡ -->
      <view class="bottom-spacer" style="height: {{toolbarHeight + 20}}px;"></view>
    </scroll-view>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <view class="toolbar-section" style="height: {{toolbarHeight}}px;">
      <view class="toolbar-content">
        <!-- å·¦ä¾§ï¼šåª’ä½“å·¥å…· -->
        <view class="toolbar-left">
          <view class="toolbar-btn" bindtap="insertImage">
            <text class="toolbar-icon">ğŸ“·</text>
          </view>
          <view class="toolbar-btn" bindtap="insertVideo">
            <text class="toolbar-icon">ğŸ¬</text>
          </view>
          <view class="toolbar-btn" bindtap="insertCover">
            <text class="toolbar-icon">ğŸ–¼ï¸</text>
          </view>
        </view>

        <!-- ä¸­é—´ï¼šæ ¼å¼å·¥å…· -->
        <view class="toolbar-center">
          <view class="toolbar-btn" bindtap="showFontOptions">
            <text class="toolbar-icon">Aa</text>
          </view>
        </view>

        <!-- å³ä¾§ï¼šç¼–è¾‘å·¥å…· -->
        <view class="toolbar-right">
          <view class="toolbar-btn {{canUndo ? '' : 'disabled'}}" bindtap="undo" disabled="{{!canUndo}}">
            <text class="toolbar-icon">â†¶</text>
          </view>
          <view class="toolbar-btn {{canRedo ? '' : 'disabled'}}" bindtap="redo" disabled="{{!canRedo}}">
            <text class="toolbar-icon">â†·</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ†ç±»é€‰æ‹©å¼¹çª— -->
    <view wx:if="{{showCategoryModal}}" class="modal-mask" bindtap="hideCategoryPicker">
      <view class="modal-content" catchtap="stopPropagation">
        <view class="modal-header">
          <text class="modal-title">é€‰æ‹©åˆ†ç±»</text>
          <text class="modal-close" bindtap="hideCategoryPicker">Ã—</text>
        </view>
        <scroll-view class="modal-body" scroll-y>
          <view 
            wx:for="{{apiList}}" 
            wx:key="*this"
            class="category-option {{apiName === item ? 'selected' : ''}}"
            bindtap="selectCategory"
            data-category="{{item}}"
          >
            <text>{{item}}</text>
            <text wx:if="{{apiName === item}}" class="check-icon">âœ“</text>
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- å­—ä½“é€‰é¡¹å¼¹çª— -->
    <view wx:if="{{showFontModal}}" class="modal-mask" bindtap="hideFontOptions">
      <view class="modal-content font-modal" catchtap="stopPropagation">
        <view class="font-options">
          <view class="font-option" bindtap="formatText" data-format="bold">
            <text class="font-icon">B</text>
            <text class="font-label">ç²—ä½“</text>
          </view>
          <view class="font-option" bindtap="formatText" data-format="italic">
            <text class="font-icon">I</text>
            <text class="font-label">æ–œä½“</text>
          </view>
          <view class="font-option" bindtap="formatText" data-format="h2">
            <text class="font-icon">H</text>
            <text class="font-label">æ ‡é¢˜</text>
          </view>
        </view>
      </view>
    </view>


    <!-- ä¸Šä¼ è¿›åº¦æç¤º -->
    <view wx:if="{{showUploadProgress}}" class="upload-progress-mask">
      <view class="upload-progress-container">
        <view class="upload-progress-icon">
          <text wx:if="{{uploadType === 'cover'}}">ğŸ–¼ï¸</text>
          <text wx:elif="{{uploadType === 'image'}}">ğŸ“·</text>
          <text wx:elif="{{uploadType === 'video'}}">ğŸ¬</text>
          <text wx:else>ğŸ“¤</text>
        </view>
        <view class="upload-progress-text">
          <text wx:if="{{uploadType === 'cover'}}">ä¸Šä¼ å°é¢ä¸­...</text>
          <text wx:elif="{{uploadType === 'image'}}">ä¸Šä¼ å›¾ç‰‡ä¸­... ({{uploadCurrent}}/{{uploadTotal}})</text>
          <text wx:elif="{{uploadType === 'video'}}">ä¸Šä¼ è§†é¢‘ä¸­...</text>
          <text wx:else>ä¸Šä¼ ä¸­...</text>
        </view>
        <view class="upload-progress-bar">
          <view class="upload-progress-fill" style="width: {{uploadProgress}}%"></view>
        </view>
        <view class="upload-progress-percent">{{uploadProgress}}%</view>
      </view>
    </view>
  </view>
</view>
