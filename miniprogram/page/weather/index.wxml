<view class="page" data-weui-theme="light">
  <view class="container">
    <view class="weather-section">
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading-container">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- é”™è¯¯çŠ¶æ€ -->
      <view wx:elif="{{error}}" class="error-container">
        <text class="error-text">è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</text>
        <button class="retry-btn" bindtap="retry">é‡è¯•</button>
      </view>

      <!-- å†…å®¹åŒºåŸŸ -->
      <block wx:else>
        <!-- å…¨åŸŸé¢„è­¦ -->
        <view wx:if="{{globalAlert}}" class="global-alert {{getAlertLevelClass(globalAlert.level)}}">
          <view class="alert-icon">ğŸš¨</view>
          <view class="alert-message">{{globalAlert.message}}</view>
        </view>

        <!-- æ¿å—ä¸€ï¼šçƒ­é—¨æ™¯ç‚¹"å®œæ¸¸æŒ‡æ•°" -->
        <view class="section-block">
          <view class="section-title">çƒ­é—¨æ™¯ç‚¹"å®œæ¸¸æŒ‡æ•°"</view>
          <scroll-view class="attractions-scroll" scroll-x="true" show-scrollbar="false">
            <view class="attractions-container">
              <view 
                wx:for="{{attractions}}" 
                wx:key="id"
                wx:for-item="attraction"
                class="attraction-card"
              >
                <view class="attraction-name">{{attraction.name}}</view>
                <view class="attraction-info">
                  <view class="info-item">
                    <text class="info-icon">ğŸŒ¡ï¸</text>
                    <text class="info-text">{{attraction.temperature}}â„ƒ ({{getTemperatureDesc(attraction.temperature)}})</text>
                  </view>
                  <view class="info-item">
                    <text class="info-icon">ğŸ‘€</text>
                    <text class="info-text">èƒ½è§åº¦ï¼š{{attraction.visibility}}</text>
                    <text wx:if="{{attraction.visibility === 'é«˜'}}" class="info-badge">ğŸ“¸ é€‚åˆæ‹ç…§</text>
                  </view>
                  <view class="info-item">
                    <text class="info-icon">â˜€ï¸</text>
                    <text class="info-text">ç´«å¤–çº¿ï¼š{{getUVDesc(attraction.uvIndex)}} ({{attraction.uvIndex}})</text>
                  </view>
                  <view wx:if="{{attraction.windSpeed}}" class="info-item">
                    <text class="info-icon">ğŸŒ¬ï¸</text>
                    <text class="info-text">é£åŠ›ï¼š{{attraction.windSpeed}}</text>
                  </view>
                </view>
                <view wx:if="{{attraction.suggestion}}" class="attraction-suggestion">
                  <text class="suggestion-icon">ğŸš©</text>
                  <text class="suggestion-text">å»ºè®®ï¼š{{attraction.suggestion}}</text>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>

        <!-- æ¿å—äºŒï¼šè·¯å†µå¹¿æ’­ -->
        <view wx:if="{{traffic.length > 0}}" class="section-block">
          <view class="section-title">å®æ—¶è·¯å†µ & çªå‘äº‹ä»¶</view>
          <view class="traffic-timeline">
            <view 
              wx:for="{{traffic}}" 
              wx:key="id"
              wx:for-item="item"
              wx:for-index="index"
              class="traffic-item"
            >
              <view class="timeline-dot"></view>
              <view class="timeline-line" wx:if="{{index < traffic.length - 1}}"></view>
              <view class="traffic-content">
                <view class="traffic-header">
                  <text class="traffic-time">{{item.time}}</text>
                  <view class="traffic-type">
                    <text class="traffic-type-icon">{{getTrafficTypeIcon(item.type)}}</text>
                    <text class="traffic-type-text">[{{item.type}}]</text>
                  </view>
                </view>
                <view class="traffic-message">
                  <text wx:if="{{item.location}}" class="traffic-location">{{item.location}}</text>
                  <text class="traffic-text">{{item.message}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{!globalAlert && attractions.length === 0 && traffic.length === 0}}" class="empty-container">
          <text class="empty-text">æš‚æ— å‡ºè¡Œä¿¡æ¯</text>
        </view>
      </block>
    </view>
  </view>
</view>
