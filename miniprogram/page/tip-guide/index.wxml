<view class="page" data-weui-theme="light" style="width: 100%; overflow-x: hidden;">
  <view class="container">
    <!-- æœç´¢åŒºåŸŸ -->
    <view class="filter-section">
      <view class="search-box">
        <input 
          class="search-input"
          placeholder="æœç´¢æŒ‡å—..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
        <text class="search-icon">ğŸ”</text>
      </view>
    </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading-container">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- é”™è¯¯çŠ¶æ€ -->
      <view wx:elif="{{error}}" class="error-container">
        <text class="error-text">è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</text>
        <button class="retry-btn" bindtap="retry">é‡è¯•</button>
      </view>

    <!-- ç€‘å¸ƒæµåˆ—è¡¨ -->
      <block wx:else>
      <view wx:if="{{filteredItems.length === 0}}" class="empty-container">
        <text class="empty-text">æš‚æ— æŒ‡å—ä¿¡æ¯</text>
      </view>
      <view wx:else class="waterfall-container">
        <view class="waterfall-column">
          <view 
            wx:for="{{filteredItems}}" 
            wx:key="id"
            wx:for-item="item"
            wx:for-index="index"
            wx:if="{{index % 2 === 0}}"
            class="waterfall-item"
            bindtap="viewDetail"
            data-item="{{item}}"
          >
            <view class="item-image-wrapper">
              <image 
                class="item-image" 
                src="{{item.image}}" 
                mode="aspectFill"
                binderror="onImageError"
                data-index="{{index}}"
                data-id="{{item.id}}"
              ></image>
              <view wx:if="{{!item.published}}" class="draft-badge">è‰ç¨¿</view>
            </view>
            <view class="item-content">
              <view class="item-title">{{item.name}}</view>
              <view wx:if="{{item.description}}" class="item-description">{{item.description}}</view>
              <!-- æµè§ˆé‡å’Œå‘å¸ƒè€…ä¿¡æ¯ï¼ˆç´§å‡‘æ˜¾ç¤ºï¼‰ -->
              <view wx:if="{{item.formattedViews || item.authorInfo}}" class="item-meta-compact">
                <view wx:if="{{item.formattedViews}}" class="meta-views-compact">
                  <text class="meta-icon">ğŸ‘ï¸</text>
                  <text class="meta-text">{{item.formattedViews}}</text>
                </view>
                <view wx:if="{{item.authorInfo && item.authorInfo.nickname}}" class="meta-author-compact">
                  <text class="meta-icon">ğŸ‘¤</text>
                  <text class="meta-text">{{item.authorInfo.nickname}}</text>
                </view>
              </view>
              <view wx:if="{{item.latitude && item.longitude || item.phone}}" class="item-footer">
                <view wx:if="{{item.latitude && item.longitude}}" class="location-btn" catchtap="openLocation" data-item="{{item}}">
                  <text class="location-icon">ğŸ“</text>
                  <text class="location-text">å¯¼èˆª</text>
                </view>
                <view wx:if="{{item.phone}}" class="phone-btn" catchtap="makePhoneCall" data-item="{{item}}">
                  <text class="phone-icon">ğŸ“</text>
                  <text class="phone-text">å‘¼å«</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        <view class="waterfall-column">
          <view 
            wx:for="{{filteredItems}}" 
            wx:key="id"
            wx:for-item="item"
            wx:for-index="index"
            wx:if="{{index % 2 === 1}}"
            class="waterfall-item"
            bindtap="viewDetail"
            data-item="{{item}}"
          >
            <view class="item-image-wrapper">
              <image 
                class="item-image" 
                src="{{item.image}}" 
                mode="aspectFill"
                binderror="onImageError"
                data-index="{{index}}"
                data-id="{{item.id}}"
              ></image>
              <view wx:if="{{!item.published}}" class="draft-badge">è‰ç¨¿</view>
            </view>
            <view class="item-content">
              <view class="item-title">{{item.name}}</view>
              <view wx:if="{{item.description}}" class="item-description">{{item.description}}</view>
              <!-- æµè§ˆé‡å’Œå‘å¸ƒè€…ä¿¡æ¯ï¼ˆç´§å‡‘æ˜¾ç¤ºï¼‰ -->
              <view wx:if="{{item.formattedViews || item.authorInfo}}" class="item-meta-compact">
                <view wx:if="{{item.formattedViews}}" class="meta-views-compact">
                  <text class="meta-icon">ğŸ‘ï¸</text>
                  <text class="meta-text">{{item.formattedViews}}</text>
                </view>
                <view wx:if="{{item.authorInfo && item.authorInfo.nickname}}" class="meta-author-compact">
                  <text class="meta-icon">ğŸ‘¤</text>
                  <text class="meta-text">{{item.authorInfo.nickname}}</text>
                </view>
              </view>
              <view wx:if="{{item.latitude && item.longitude || item.phone}}" class="item-footer">
                <view wx:if="{{item.latitude && item.longitude}}" class="location-btn" catchtap="openLocation" data-item="{{item}}">
                  <text class="location-icon">ğŸ“</text>
                  <text class="location-text">å¯¼èˆª</text>
                </view>
                <view wx:if="{{item.phone}}" class="phone-btn" catchtap="makePhoneCall" data-item="{{item}}">
                  <text class="phone-icon">ğŸ“</text>
                  <text class="phone-text">å‘¼å«</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      <!-- åŠ è½½æ›´å¤šæŒ‰é’® -->
      <view wx:if="{{hasMore && !loadingMore && !preloading && !loading}}" class="load-more-container">
        <text class="load-more-btn" bindtap="loadMore">åŠ è½½æ›´å¤š</text>
      </view>
      <!-- åŠ è½½ä¸­æç¤º -->
      <view wx:if="{{loadingMore || preloading}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      <!-- æ²¡æœ‰æ›´å¤šæç¤º -->
      <view wx:if="{{!hasMore && items.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
      </view>
      </block>
  </view>
</view>
